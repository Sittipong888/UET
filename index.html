<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ลงคิวรถ Universal Express Transport</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .header {
      margin-bottom: 20px;
    }
    .logo {
      max-width: 200px;
      opacity: 1.0; /* ลดความคมชัด */
      filter: blur(0px);
    }
    h1 {
      font-size: 1.5em;
      color: #2c3e50;
      margin: 10px 0;
    }
    p {
      font-size: 1.2em;
      color: #7f8c8d;
    }
    .container {
      background: rgba(255, 255, 255, 0.9);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      margin: 0 auto;
    }
    select, button {
      padding: 12px;
      margin: 10px;
      font-size: 1em;
      border: 1px solid #3498db;
      border-radius: 5px;
      background: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #3498db;
      color: white;
    }
    a {
      display: inline-block;
      padding: 12px 25px;
      background: #2ecc71;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      margin-top: 15px;
    }
    a:hover {
      background: #27ae60;
    }
    #message {
      margin: 10px 0;
      font-weight: bold;
    }
  </style>
  <script>
    const rayongLat = 12.96980463108979; // พิกัดระยอง
    const rayongLong = 101.1129185324132;
    const saraburiLat = 14.390552298546279; // พิกัดสระบุรี
    const saraburiLong = 100.89930615784056;
    const rayongMaxDistance = 160; // ระยะห่างสำหรับระยอง
    const saraburiMaxDistance = 50; // ระยะห่างสำหรับสระบุรี
    const moveSingleMaxDistance = 180; // ระยะห่างสำหรับงานย้ายขาเดียว
    const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdaqw0EGWNSwy9gd74SMQJhJBTjniIJBRp1ZmweJmwiVExZ_w/viewform?usp=sharing&ouid=107693525130515987915"; // URL ฟอร์มจริง
    const nameEntryId = "entry.123456789"; // เปลี่ยนตาม ID ช่องชื่อ-นามสกุล
    const regEntryId = "entry.987654321"; // เปลี่ยนตาม ID ช่องทะเบียน
    const lastJobEntryId = "entry.111222333"; // เปลี่ยนตาม ID ช่องงานล่าสุด
    const locationEntryId = "entry.XXXXXX"; // เปลี่ยนตาม ID ช่อง "ลงคิวที่ไหน" (ตรวจสอบจาก Google Form)

    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function checkLocation() {
      const location = document.getElementById("location").value;
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            const userLat = position.coords.latitude;
            const userLong = position.coords.longitude;
            let centerLat, centerLong, maxDistance, messageText, locationParam = "";
            if (location === "rayong") {
              centerLat = rayongLat;
              centerLong = rayongLong;
              maxDistance = rayongMaxDistance;
              messageText = `อยู่ในรัศมี 200 กม. (Lat: ${userLat}, Long: ${userLong}) คลิกเพื่อลงคิว`;
              locationParam = "&entry.1261874857=ระยอง"; // ล็อคเลือก "ระยอง" ในฟอร์ม
            } else if (location === "saraburi") {
              centerLat = saraburiLat;
              centerLong = saraburiLong;
              maxDistance = saraburiMaxDistance;
              messageText = `อยู่ในรัศมี 50 กม. (Lat: ${userLat}, Long: ${userLong}) คลิกเพื่อลงคิว`;
              locationParam = "&entry.1261874857=สระบุรี"; // ล็อคเลือก "สระบุรี" ในฟอร์ม
            } else if (location === "move_single") {
              centerLat = saraburiLat; // ใช้พิกัดเดียวกับสระบุรี
              centerLong = saraburiLong;
              maxDistance = moveSingleMaxDistance;
              messageText = `อยู่ในรัศมี 255 กม. (Lat: ${userLat}, Long: ${userLong}) คลิกเพื่อลงคิว`;
              // ไม่ล็อค "ลงคิวที่ไหน" สำหรับ move_single
            } else {
              document.getElementById("message").innerText = "กรุณาเลือกจุดลงคิว";
              document.getElementById("formLink").style.display = "none";
              return;
            }
            const distance = calculateDistance(userLat, userLong, centerLat, centerLong);
            if (distance > maxDistance) {
              alert("คุณอยู่นอกรัศมี " + maxDistance + " กม. จาก " + location);
              document.getElementById("formLink").style.display = "none";
              document.getElementById("message").innerText = "ไม่สามารถลงคิวได้";
            } else {
              const url = `${formUrl}?${nameEntryId}=&${regEntryId}=&${lastJobEntryId}=${locationParam}`;
              document.getElementById("formLink").href = url;
              document.getElementById("formLink").style.display = "block";
              document.getElementById("message").innerText = messageText;
            }
          },
          function(error) {
            alert("ไม่สามารถดึงพิกัดได้ กรุณาเปิด GPS");
            document.getElementById("message").innerText = "กรุณาเปิด GPS และลองใหม่";
          }
        );
      } else {
        alert("เบราว์เซอร์ไม่รองรับ Geolocation");
        document.getElementById("message").innerText = "เบราว์เซอร์ไม่รองรับ";
      }
    }
  </script>
</head>
<body>
  <div class="header">
    <img src="https://img2.pic.in.th/pic/296b846e72b8fc9af.png" alt="Universal Express Transport Logo" class="logo">
    <h1>ลงคิวรถ Universal Express Transport</h1>
    <p>ระบบลงคิวสำหรับพนักงานขับรถ</p>
  </div>
  <div class="container">
    <select id="location" onchange="checkLocation()">
      <option value="">เลือกจุดลงคิว</option>
      <option value="rayong">ระยอง (ห่าง 200 กม.)</option>
      <option value="saraburi">สระบุรี (ห่าง 50 กม.)</option>
      <option value="move_single">สำหรับพขร.ที่ขึ้นงานย้ายเสร็จแล้ว (ระยะห่างระยอง-สระบุรี)</option>
    </select>
    <p id="message">กรุณาเลือกจุดลงคิวและรอขณะตรวจสอบพิกัด ระยะไม่เกินจากรัศมี ...</p>
    <a id="formLink" href="#" style="display:none;">ไปที่ฟอร์มลงคิวรถ</a>
  </div>
</body>
</html>
